<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" label="Address"
  xmlns:rcomponents="org.ruboss.components.*">
<mx:Script><![CDATA[
  import org.ruboss.Ruboss;
  import org.ruboss.utils.RubossUtils;
  import contacts.models.Address;
  import contacts.models.Contact;
  import contacts.models.Company;

  [Bindable]
  public var editedAddress:Address = new Address();
  
  public function createAddress():void {
    var address:Address = new Address();
    address.lineOne = lineOneTextInput.text;
    address.lineTwo = lineTwoTextInput.text;
    address.city = cityTextInput.text;
    address.state = stateTextInput.text;
    address.zip = zipTextInput.text;
    address.country = countryTextInput.text;

    address.contact = Contact(contactComboBox.selectedItem);
    address.company = Company(companyComboBox.selectedItem);
    address.create(onAddressCreate);
//    Ruboss.models.create(address, onAddressCreate);
  }

  public function updateAddress():void {
    editedAddress.lineOne = lineOneTextInput.text;
    editedAddress.lineTwo = lineTwoTextInput.text;
    editedAddress.city = cityTextInput.text;
    editedAddress.state = stateTextInput.text;
    editedAddress.zip = zipTextInput.text;
    editedAddress.country = countryTextInput.text;

    editedAddress.contact = Contact(contactComboBox.selectedItem);
    editedAddress.company = Company(companyComboBox.selectedItem);
    editedAddress.update(onAddressUpdate);
//    Ruboss.models.update(editedAddress, onAddressUpdate);
  }

  public function destroyAddress():void {
    editedAddress.destroy(onAddressDestroy);
//    Ruboss.models.destroy(editedAddress, onAddressDestroy);
  }
  
  private function onAddressSelect():void {
    editedAddress = RubossUtils.clone(addressesDataGrid.selectedItem) as Address;
  }
  
  private function onAddressCreate(address:Address):void {
    editedAddress = new Address;
  }
  
  private function onAddressUpdate(address:Address):void {
    addressesDataGrid.selectedItem = address;
    editedAddress = RubossUtils.clone(address) as Address;
  }
  
  private function onAddressDestroy(address:Address):void {
    onAddressCreate(address);
  }
]]></mx:Script>
  <mx:Panel id="addressesPanel" title="Addresses List"
    width="{width}" height="300">
    <mx:DataGrid id="addressesDataGrid"
      height="100%"
      horizontalScrollPolicy="auto"
      dataProvider="{Ruboss.models.index(Address)}"
      change="onAddressSelect()">
      <mx:columns>
        <mx:DataGridColumn dataField="lineOne" headerText="LineOne"
          width="150" minWidth="100"/>
        <mx:DataGridColumn dataField="lineTwo" headerText="LineTwo"
          width="150" minWidth="100"/>
        <mx:DataGridColumn dataField="city" headerText="City"
          width="150" minWidth="100"/>
        <mx:DataGridColumn dataField="state" headerText="State"
          width="150" minWidth="100"/>
        <mx:DataGridColumn dataField="zip" headerText="Zip"
          width="150" minWidth="100"/>
        <mx:DataGridColumn dataField="country" headerText="Country"
          width="150" minWidth="100"/>
        <mx:DataGridColumn editable="false" sortable="false"
          width="150" dataField="contact"
          headerText="Contact">
        </mx:DataGridColumn>
        <mx:DataGridColumn editable="false" sortable="false"
          width="150" dataField="company"
          headerText="Company">
        </mx:DataGridColumn>
        <mx:DataGridColumn headerText="" width="70" minWidth="70"
          editable="false" dataField="name">
          <mx:itemRenderer>
            <mx:Component>
              <mx:HBox horizontalAlign="center" paddingLeft="2"
                paddingRight="2">
                <mx:Button label="delete" width="100%"
                  click="outerDocument.destroyAddress()">
                </mx:Button>
              </mx:HBox>
            </mx:Component>
          </mx:itemRenderer>
        </mx:DataGridColumn>
      </mx:columns>
    </mx:DataGrid>
  </mx:Panel>
  <mx:Panel title="Address Editor" width="100%" height="{height - 320}" verticalScrollPolicy="auto">
    <mx:Form width="100%" height="100%">
      <mx:FormItem label="LineOne" width="100%">
        <mx:TextInput id="lineOneTextInput" width="100%"
          text="{editedAddress.lineOne}"/>
      </mx:FormItem>
      <mx:FormItem label="LineTwo" width="100%">
        <mx:TextInput id="lineTwoTextInput" width="100%"
          text="{editedAddress.lineTwo}"/>
      </mx:FormItem>
      <mx:FormItem label="City" width="100%">
        <mx:TextInput id="cityTextInput" width="100%"
          text="{editedAddress.city}"/>
      </mx:FormItem>
      <mx:FormItem label="State" width="100%">
        <mx:TextInput id="stateTextInput" width="100%"
          text="{editedAddress.state}"/>
      </mx:FormItem>
      <mx:FormItem label="Zip" width="100%">
        <mx:TextInput id="zipTextInput" width="100%"
          text="{editedAddress.zip}"/>
      </mx:FormItem>
      <mx:FormItem label="Country" width="100%">
        <mx:TextInput id="countryTextInput" width="100%"
          text="{editedAddress.country}"/>
      </mx:FormItem>
      <mx:FormItem label="Contact" width="100%">
        <mx:ComboBox id="contactComboBox"
          width="150" labelField="{Contact.LABEL}"
          dataProvider="{Ruboss.models.index(Contact)}"
          selectedItem="{editedAddress.contact}" />
      </mx:FormItem>
      <mx:FormItem label="Company" width="100%">
        <mx:ComboBox id="companyComboBox"
          width="150" labelField="{Company.LABEL}"
          dataProvider="{Ruboss.models.index(Company)}"
          selectedItem="{editedAddress.company}" />
      </mx:FormItem>
    </mx:Form>
    <mx:ControlBar width="100%" height="100%">
      <mx:Button label="Create Address" width="34%" height="30"
        click="createAddress()"/>
      <mx:Button label="Update Address" width="33%" height="30"
        enabled="{addressesDataGrid.selectedItem != null}"
        click="updateAddress()"/>
      <mx:Button label="Delete Address" width="33%" height="30"
        enabled="{addressesDataGrid.selectedItem != null}"
        click="destroyAddress()"/>
    </mx:ControlBar>
  </mx:Panel>
</mx:VBox>